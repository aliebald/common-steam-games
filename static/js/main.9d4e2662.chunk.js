(this["webpackJsonpcommon-steam-games"]=this["webpackJsonpcommon-steam-games"]||[]).push([[0],{27:function(e){e.exports=JSON.parse('{"name":"common-steam-games","version":"0.1.0","private":true,"homepage":"http://aliebald.github.io/common-steam-games","subUrl":"/common-steam-games","dependencies":{"@testing-library/jest-dom":"^5.14.1","@testing-library/react":"^11.2.7","@testing-library/user-event":"^12.8.3","@types/jest":"^26.0.24","@types/node":"^12.20.33","@types/react":"^17.0.29","@types/react-dom":"^17.0.9","@types/react-router-dom":"^5.3.1","react":"^17.0.2","react-beautiful-dnd":"^13.1.0","react-dom":"^17.0.2","react-router-dom":"^5.3.0","react-scripts":"4.0.3","socket.io-client":"^4.3.2","typescript":"^4.4.4","web-vitals":"^1.1.2"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build","deploy":"gh-pages -d build -m \\"Auto generated updates for GitHub Pages deployment\\""},"eslintConfig":{"extends":["react-app","react-app/jest"]},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@types/react-beautiful-dnd":"^13.1.2","gh-pages":"^3.2.3"}}')},42:function(e,t,s){},52:function(e,t,s){},59:function(e,t,s){},60:function(e,t,s){},61:function(e,t,s){},62:function(e,t,s){},63:function(e,t,s){},64:function(e,t,s){},69:function(e,t,s){},70:function(e,t,s){"use strict";s.r(t);var n=s(0),c=s.n(n),r=s(23),a=s.n(r),o=(s(52),s(4)),i=s(3),l=s(21),d=s(29),j=s.n(d),u=s(35),m=s(1);function b(e){var t,s=Object(n.useState)(null!==(t=e.steamId)&&void 0!==t?t:""),c=Object(o.a)(s,2),r=c[0],a=c[1],d=Object(i.g)(),b=function(){var t=Object(u.a)(j.a.mark((function t(s){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s.preventDefault(),e.onSubmit(r),d.push("/matching");case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(m.jsx)("div",{className:"user-forms",children:Object(m.jsxs)("div",{className:"create-session",children:[Object(m.jsx)("h2",{children:"Create a new Session"}),Object(m.jsxs)("form",{onSubmit:b,children:[Object(m.jsxs)("label",{children:["Steam Id:",Object(m.jsx)("input",{type:"text",name:"steamId",id:"createSessionSteamId",onChange:function(e){a(e.target.value)},className:"d-table-cell",defaultValue:r,required:!0})]}),Object(m.jsx)("input",{type:"submit",value:"Create New Session",className:"btn"})]}),Object(m.jsxs)("p",{className:"t-center",children:["Or ",Object(m.jsx)(l.b,{to:"/join",children:"join a existing session"})]})]})})}s(59);var p=s(27);function f(){return Object(m.jsxs)("div",{className:"footer",children:[Object(m.jsx)("div",{className:"f-left",children:"This project is not affiliated with Valve or Steam"}),Object(m.jsx)("a",{className:"f-right",href:"https://github.com/aliebald/common-steam-games",target:"_blank",rel:"noopener noreferrer",title:"GitHub Repository",children:Object(m.jsx)("img",{src:"".concat(p.subUrl,"/github.png"),alt:"github",height:"20px",width:"20px"})})]})}function h(e){var t,s,c=Object(n.useState)(null!==(t=e.steamId)&&void 0!==t?t:""),r=Object(o.a)(c,2),a=r[0],d=r[1],b=Object(n.useState)(null!==(s=e.sessionId)&&void 0!==s?s:""),p=Object(o.a)(b,2),f=p[0],h=p[1],O=Object(i.g)(),v=function(){var t=Object(u.a)(j.a.mark((function t(s){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s.preventDefault(),e.onSubmit(a,f),O.push("/matching");case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(m.jsx)("div",{className:"user-forms",children:Object(m.jsxs)("div",{className:"join-session",children:[Object(m.jsx)("h2",{children:"Join a Session"}),Object(m.jsxs)("form",{className:"d-table",onSubmit:v,children:[Object(m.jsxs)("div",{className:"d-table-row",children:[Object(m.jsx)("label",{htmlFor:"steamId",className:"d-table-cell",children:"Steam Id:\xa0"}),Object(m.jsx)("input",{type:"text",name:"steamId",id:"steamId",onChange:function(e){d(e.target.value)},className:"d-table-cell",defaultValue:a,required:!0})]}),Object(m.jsxs)("div",{className:"d-table-row",children:[Object(m.jsx)("label",{htmlFor:"sessionId",className:"d-table-cell",children:"Session Id:\xa0"}),Object(m.jsx)("input",{type:"text",name:"sessionId",id:"sessionId",onChange:function(e){h(e.target.value)},className:"d-table-cell",defaultValue:f,required:!0})]}),Object(m.jsxs)("div",{className:"d-table-row",children:[Object(m.jsx)("div",{className:"d-table-cell"}),Object(m.jsx)("div",{className:"d-table-cell",children:Object(m.jsx)("input",{type:"submit",value:"Join Session",className:"btn"})})]})]}),Object(m.jsxs)("p",{className:"t-center",children:["Or ",Object(m.jsx)(l.b,{to:"/",children:"create a new session"})]})]})})}s(60);function O(){return Object(m.jsxs)("div",{className:"unknown-page",children:[Object(m.jsx)("p",{children:"The page you are looking for was not found."}),Object(m.jsxs)("p",{children:["You can ",Object(m.jsx)(l.b,{to:"/create",children:"create a new session"})," or ",Object(m.jsx)(l.b,{to:"/join",children:"join an existing session"}),"."]})]})}var v=s(22),g=s(37);function x(e){var t,s,c=Object(n.useState)(!0),r=Object(o.a)(c,2),a=r[0],i=r[1],l=Object(n.useState)(!0),d=Object(o.a)(l,2),j=d[0],u=d[1],b=Object(n.useState)(void 0),p=Object(o.a)(b,2),f=p[0],h=p[1],O=null!==(t=e.children)&&void 0!==t?t:"No Content";return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("button",{type:"button",className:"collapsible",onClick:function(){if(f&&(clearTimeout(f),h(void 0)),a)u(!1);else{var e=setTimeout((function(){return u(!0)}),500);h(e)}i(!a)},children:[null!==(s=e.header)&&void 0!==s?s:"Open",Object(m.jsx)("i",{className:a?"arrow-down":"arrow-up"})]}),Object(m.jsx)("div",{className:"content ".concat(a?"content-collapsed":""),children:j?Object(m.jsx)(m.Fragment,{}):O})]})}var I=s(33);s(61);function N(e){var t,s,n=Math.round(100*(e.game.playtime_forever/60+Number.EPSILON))/100,c=e.game.playtime_2weeks?Math.round(100*(e.game.playtime_2weeks/60+Number.EPSILON))/100:0;return t=e.game.weight?"Average Playtime ".concat(n,"h - w: ").concat(e.game.weight):c>0?"Playtime: ".concat(n,"h / ").concat(c,"h"):"Playtime: ".concat(n,"h"),Object(m.jsx)("div",{className:"game",children:Object(m.jsxs)("div",{className:"gameInner",children:[Object(m.jsx)("a",{href:(s=e.game.appid,"https://store.steampowered.com/app/".concat(s)),target:"_blank",rel:"noopener noreferrer",title:"".concat(e.game.name," steam page"),children:Object(m.jsx)("img",{src:w(e.game.appid,e.game.img_icon_url),width:"32",height:"32",alt:"icon"})}),Object(m.jsxs)("div",{className:"game-info",children:[Object(m.jsx)("div",{className:"title",children:e.game.name}),Object(m.jsx)("div",{className:"playtime",children:t})]})]})})}function w(e,t){return"https://media.steampowered.com/steamcommunity/public/images/apps/".concat(e,"/").concat(t,".jpg")}function S(e){return Object(m.jsx)(I.b,{draggableId:"".concat(e.game.appid),index:e.index,children:function(t){return Object(m.jsx)("div",Object(v.a)(Object(v.a)(Object(v.a)({ref:t.innerRef},t.draggableProps),t.dragHandleProps),{},{children:Object(m.jsx)(N,{game:e.game})}))}})}function y(e){var t,s,n,c=null!==(t=e.header)&&void 0!==t?t:"";return e.droppableId&&e.onDragEnd?Object(m.jsx)("div",{className:"games-list ".concat(null!==(n=e.className)&&void 0!==n?n:""),children:Object(m.jsxs)(I.a,{onDragEnd:e.onDragEnd,children:[c,Object(m.jsx)("div",{className:"scroll-container",children:Object(m.jsx)(I.c,{droppableId:e.droppableId,children:function(t){return Object(m.jsxs)("div",Object(v.a)(Object(v.a)({},t.droppableProps),{},{ref:t.innerRef,children:[Object(m.jsx)(_,{games:e.games}),t.placeholder]}))}})})]})}):Object(m.jsxs)("div",{className:"games-list ".concat(null!==(s=e.className)&&void 0!==s?s:""),children:[c,Object(m.jsx)("div",{className:"scroll-container",children:e.games.map((function(e,t){return Object(m.jsx)(N,{game:e},t)}))})]})}var _=c.a.memo((function(e){var t=e.games.map((function(e,t){return Object(m.jsx)(S,{game:e,index:t},e.appid)}));return Object(m.jsx)(m.Fragment,{children:t})}));s(62);function E(e){var t,s="".concat(window.location.origin).concat(p.subUrl,"/join?sessionId=").concat(encodeURIComponent(e.sessionId));return Object(m.jsxs)("div",{className:"inviteBox ".concat(null!==(t=e.className)&&void 0!==t?t:""),children:["Invite\xa0Link:\xa0",Object(m.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:e.sessionId})]})}s(63);function k(e){var t;return Object(m.jsxs)("div",{className:"lds-roller ".concat(null!==(t=e.className)&&void 0!==t?t:""),children:[Object(m.jsx)("div",{}),Object(m.jsx)("div",{}),Object(m.jsx)("div",{}),Object(m.jsx)("div",{}),Object(m.jsx)("div",{}),Object(m.jsx)("div",{}),Object(m.jsx)("div",{}),Object(m.jsx)("div",{})]})}s(64);function P(e){var t;return Object(m.jsxs)("div",{className:"user-header ".concat(null!==(t=e.className)&&void 0!==t?t:""),children:[Object(m.jsx)("a",{href:e.user.profileurl,target:"_blank",rel:"noopener noreferrer",title:"Steam profile",children:Object(m.jsx)("img",{src:e.user.avatarmedium,width:"45",height:"45",alt:"avatar"})}),Object(m.jsx)("h2",{children:e.title})]})}var C=s(47);var R=function(e,t,s){var n=Array.from(e),c=n.splice(t,1),r=Object(o.a)(c,1)[0];return n.splice(s,0,r),n},U=function(e){var t,s=Object(n.useState)([]),c=Object(o.a)(s,2),r=c[0],a=c[1],l=Object(n.useState)({steamId:e.steamId}),d=Object(o.a)(l,2),j=d[0],u=d[1],b=Object(n.useState)([]),p=Object(o.a)(b,2),f=p[0],h=p[1],O=Object(n.useState)(""),I=Object(o.a)(O,2),N=I[0],w=I[1],S=Object(n.useState)(!1),_=Object(o.a)(S,2),U=_[0],D=_[1],A=Object(n.useState)(void 0),L=Object(o.a)(A,2),F=L[0],J=L[1],T=Object(i.g)();return Object(n.useEffect)((function(){F&&(F.removeAllListeners(),F.on("error",(function(t){var s=t;s.timeout=15e3,e.addError(s),T.goBack()})),F.on("session",(function(e){if(console.log("Received session:",e),e)if(r.length>0)console.warn("Received session but already is part of a session");else{var t=e,s=t.users.filter((function(e){return e.steamId!==j.steamId})),n=t.users.find((function(e){return e.steamId===j.steamId}));w(t.sessionId),u(n),a(s)}})),F.on("userJoined",(function(e){console.log("Received handleUserJoined:",e,"users:",r);var t=Object(g.a)(r);t.push(e),a(t)})),F.on("userDisconnect",(function(e){console.log("Received handleUserDisconnect:",e,"users:",r);var t=r.filter((function(t){return t.steamId!==e}));a(t)})),F.on("updatePreferences",(function(e){console.log("Received updatePreferences:",e);var t=e,s=Object(g.a)(r),n=s.findIndex((function(e){return e.steamId===t.steamId}));-1!==n?(console.log("Updating preferences for ".concat(s[n].personaname," (").concat(t.steamId,")"),n),s[n].preferences=t.preferences,a(s)):console.log("Tried to update preferences for ".concat(t.steamId," but did not find user"))})))}),[j.steamId,r,F,e,T]),Object(n.useEffect)((function(){var t=function(e,t){var s;return s=t?{steamId:e,sessionId:t}:{steamId:e},Object(C.a)("http://localhost:3030",{query:s,reconnectionAttempts:4})}(e.steamId,e.sessionId);return J(t),t.io.on("reconnect_failed",(function(){console.log("Failed to reconnect"),e.addError({status:500,msg:"Lost connection to server",timeout:15e3}),T.push("/create")})),t.io.on("reconnect_attempt",(function(s){var n="Lost connection to server, attempting to reconnect. Attempt (".concat(s,"/").concat(t.io.reconnectionAttempts(),")");console.log(n),e.addError({status:500,msg:n,timeout:6e3})})),function(){console.log("#### disconnecting ###"),t&&t.disconnect()}}),[e.sessionId,e.steamId]),Object(n.useEffect)((function(){h(function(e){var t=new Map,s=Math.max.apply(Math,Object(g.a)(e.map((function(e){return e.preferences?e.preferences.length:0}))));e.forEach((function(n){n.preferences&&n.preferences.forEach((function(n,c){var r,a,o=function(e,t){var s=(t-e)/t;return!isNaN(s)&&s>=0?s*s:0}(c,s);t.has(n.appid)?((r=t.get(n.appid)).weight+=o,r.playtime_forever+=n.playtime_forever/e.length):r={appid:n.appid,name:n.name,img_icon_url:n.img_icon_url,img_logo_url:n.img_logo_url,has_community_visible_stats:null!==(a=n.has_community_visible_stats)&&void 0!==a?a:void 0,playtime_2weeks:n.playtime_2weeks?n.playtime_2weeks/e.length:void 0,playtime_forever:n.playtime_forever/e.length,weight:o};t.set(n.appid,r)}))}));var n=Array.from(t.values());return n.sort((function(e,t){return t.weight-e.weight})),n}(r.concat(j)))}),[r,j]),Object(n.useEffect)((function(){U&&j.preferences&&(F?(console.log("Sending preferences"),F.emit("updatePreferences",j.preferences),D(!1)):console.error("Socket is not defined"))}),[j.preferences,U]),j.preferences?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("header",{className:"app-header",children:Object(m.jsx)("h1",{children:"Common Steam Games"})}),Object(m.jsxs)("div",{className:"container",children:[Object(m.jsx)(y,{games:null!==(t=j.preferences)&&void 0!==t?t:[],onDragEnd:function(e){var t;if(e.destination){var s=Object(v.a)({},j);s.preferences=R(null!==(t=j.preferences)&&void 0!==t?t:[],e.source.index,e.destination.index),u(s),D(!0)}},droppableId:"".concat(j.personaname,"'s Preferences"),header:Object(m.jsx)(P,{title:"Your Preferences",user:j}),className:"col"}),Object(m.jsx)(y,{games:f,header:Object(m.jsx)("h2",{className:"group-preferences-header",children:"Group Preferences"}),className:"col"}),Object(m.jsxs)("div",{className:"col",children:[Object(m.jsx)(E,{sessionId:N,className:"no-br-bottom"}),r.map((function(e,t){var s;return Object(m.jsx)(x,{header:Object(m.jsx)(P,{title:"".concat(e.personaname,"'s preferences"),user:e,className:"no-br no-bg"}),children:Object(m.jsx)(y,{games:null!==(s=e.preferences)&&void 0!==s?s:[],className:"no-br-top"},t)},"".concat(t,"-").concat(e.steamId))}))]})]})]}):Object(m.jsx)("div",{className:"t-center",children:Object(m.jsx)(k,{className:"v-centered"})})};s(42);function D(e){return Object(n.useEffect)((function(){var t,s=e.error.timeout;return s&&(t=setTimeout((function(){e.removeError()}),s)),function(){t&&clearTimeout(t)}}),[e]),Object(m.jsxs)("div",{className:"error-popup",children:[e.error.msg,Object(m.jsx)("div",{className:"error-close",onClick:e.removeError})]})}function A(e){var t=function(t){return function(){return e.setErrors(e.errors.filter((function(e){return e!==t})))}};return Object(m.jsx)("div",{className:"error-popup-list",children:Object(m.jsx)("div",{children:e.errors.map((function(e,s){return Object(m.jsx)(D,{removeError:t(e),error:e},s)}))})})}s(69);function L(){var e=Object(n.useState)(function(){var e=new URLSearchParams(window.location.search).get("steamId");if(e){var t=decodeURIComponent(e);return sessionStorage.setItem("steamId",t),t}var s=sessionStorage.getItem("steamId");if(s)return s;return}()),t=Object(o.a)(e,2),s=t[0],c=t[1],r=Object(n.useState)(function(){var e=new URLSearchParams(window.location.search).get("sessionId");if(e){var t=decodeURIComponent(e);return sessionStorage.setItem("sessionId",t),t}var s=sessionStorage.getItem("sessionId");if(s)return s;return}()),a=Object(o.a)(r,2),d=a[0],j=a[1],u=Object(n.useState)([]),v=Object(o.a)(u,2),g=v[0],x=v[1],I=d&&"/join"!==window.location.pathname,N=s?Object(m.jsx)(U,{steamId:s,sessionId:d,addError:function(e){x(g.concat(e))}}):Object(m.jsx)(i.a,{to:"/"});return Object(m.jsxs)("div",{className:"app",children:[Object(m.jsx)(A,{errors:g,setErrors:x}),Object(m.jsx)(l.a,{basename:p.subUrl,children:Object(m.jsxs)(i.d,{children:[Object(m.jsx)(i.b,{path:"/matching",exact:!0,children:N}),Object(m.jsx)(i.b,{path:"/join",exact:!0,children:Object(m.jsx)(h,{onSubmit:function(e,t){sessionStorage.setItem("steamId",e),sessionStorage.setItem("sessionId",t),c(e),j(t)},sessionId:d,steamId:s})}),Object(m.jsx)(i.b,{path:"/create",exact:!0,children:I?Object(m.jsx)(i.a,{to:"/join"}):Object(m.jsx)(b,{onSubmit:function(e){sessionStorage.setItem("steamId",e),sessionStorage.removeItem("sessionId"),c(e),j(void 0)},steamId:s})}),Object(m.jsx)(i.b,{path:"/",exact:!0,children:Object(m.jsx)(i.a,{to:"/create"})}),Object(m.jsx)(i.b,{path:"/",children:Object(m.jsx)(O,{})})]})}),Object(m.jsx)(f,{}),Object(m.jsx)("div",{className:"background"})]})}a.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(L,{})}),document.getElementById("root"))}},[[70,1,2]]]);
//# sourceMappingURL=main.9d4e2662.chunk.js.map